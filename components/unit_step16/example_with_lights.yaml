esphome:
  name: unit-16-step
  friendly_name: unit 16 Step

esp32:
  board: esp32dev
  framework:
    type: esp-idf

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "/p52UNP4294EtlpbBPrg1zol3a9P4YSzw1sluVIRkBY="

ota:
  - platform: esphome
    password: "11a02f385a1f39ef18d424ef884c85a5"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Unit-16-Step Fallback Hotspot"
    password: "vnVdFdBdrZza"

external_components:
  - source: github://Jasionf/echo-pyramid-components@main
    components: [unit_step16]
    refresh: 0s

i2c:
  - id: bsp_iic
    scl: GPIO32
    sda: GPIO26
    scan: True
    
captive_portal:


# Unit Step16 component with initial configuration
unit_step16:
  id: my_step16
  i2c_id: bsp_iic
  address: 0x48
  # Initial LED configuration
  led_brightness: 50      # LED brightness 0-100%
  led_enabled: true       # Enable LED display on boot
  # Initial RGB configuration
  rgb_brightness: 50      # RGB brightness 0-100%
  rgb_enabled: true       # Enable RGB LED on boot
  rgb_red: 0              # Initial red value 0-255
  rgb_green: 255          # Initial green value 0-255
  rgb_blue: 0             # Initial blue value 0-255 (default: green)


# Sensor to read encoder value (0-15)
sensor:
  - platform: unit_step16
    unit_step16_id: my_step16
    name: "Encoder Value"
    update_interval: 100ms
    # Optional: Add filters if needed
    # filters:
    #   - debounce: 0.1s
    
    # Optional: Trigger actions when value changes
    on_value:
      then:
        - logger.log:
            format: "Encoder value changed to: %.0f"
            args: [ 'x' ]


# Output components for LED and RGB control
output:
  # LED brightness control (0-100%)
  - platform: unit_step16
    id: led_brightness_output
    unit_step16_id: my_step16
    channel: led_brightness
  
  # RGB brightness control (0-100%)
  - platform: unit_step16
    id: rgb_brightness_output
    unit_step16_id: my_step16
    channel: rgb_brightness
  
  # RGB color channels (0-255 each)
  - platform: unit_step16
    id: rgb_red_output
    unit_step16_id: my_step16
    channel: rgb_red
  
  - platform: unit_step16
    id: rgb_green_output
    unit_step16_id: my_step16
    channel: rgb_green
  
  - platform: unit_step16
    id: rgb_blue_output
    unit_step16_id: my_step16
    channel: rgb_blue

# Create a light entity for RGB control
light:
  - platform: rgb
    id: step16_rgb_light
    name: "Step16 RGB Light"
    red: rgb_red_output
    green: rgb_green_output
    blue: rgb_blue_output
    restore_mode: ALWAYS_ON  # Keep light on after boot
    default_transition_length: 0s  # Instant transitions
    # Optional: add effects
    effects:
      - pulse:
      - strobe:
      - random:

# Create a light entity for LED brightness (monochrome)
  - platform: monochromatic
    id: step16_led_display
    name: "Step16 LED Display"
    output: led_brightness_output
    restore_mode: ALWAYS_ON  # Keep light on after boot
    default_transition_length: 0s  # Instant transitions
    # Optional: add effects
    effects:
      - pulse:
      - strobe:

# Optional: Control RGB brightness separately as a number
number:
  - platform: template
    name: "RGB Brightness"
    min_value: 0
    max_value: 100
    step: 1
    optimistic: true
    initial_value: 50
    on_value:
      then:
        - output.set_level:
            id: rgb_brightness_output
            level: !lambda 'return x / 100.0;'
